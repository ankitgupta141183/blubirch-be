class TestRule < ApplicationRecord
	acts_as_paranoid
	has_many :category_grading_rules
	has_many :categories, through: :category_grading_rules

	has_many :client_category_grading_rules
	has_many :client_categories, through: :client_category_grading_rules

	def self.update_rules
		t = TestRule.find 3
		r = {"tests"=>{"End"=>{"test_type"=>"End"}, "Ref_1"=>{"test"=>"", "options"=>[{"route"=>"End", "value"=>"Seal Pack", "output"=>"Seal Pack", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>[], "annotation_label"=>""}, {"route"=>"Ref_7", "value"=>"Open Box", "output"=>"Open Box", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>[], "annotation_label"=>""}, {"route"=>"Ref_7", "value"=>"Not Available", "output"=>"Not Available", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>[], "annotation_label"=>""}, {"route"=>"Ref_7", "value"=>"Brown Box Available", "output"=>"Brown Box Available", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>[], "annotation_label"=>""}], "picture"=>true, "test_type"=>"Packaging", "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>[], "annotation_label"=>""}, "Ref_7"=>{"test"=>"", "options"=>[{"route"=>"Ref_13", "value"=>"Unused Returned", "output"=>"Unused Returned", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"Ref_13", "value"=>"Used", "output"=>"Used", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"End", "value"=>"Missing", "output"=>"Missing", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"End", "value"=>"Mismatch", "output"=>"Mismatch", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"End", "value"=>"Fake", "output"=>"Fake", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"End", "value"=>"Complete damage", "output"=>"Defective", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}], "picture"=>true, "test_type"=>"Item Condition", "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, "Ref_8"=>{"test"=>"", "options"=>[{"route"=>"Ref_13", "value"=>"Used", "output"=>"Used", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"End", "value"=>"Missing", "output"=>"Missing", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"End", "value"=>"Mismatch", "output"=>"Mismatch", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"End", "value"=>"Fake", "output"=>"Fake", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"End", "value"=>"Complete damage", "output"=>"Defective", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}], "picture"=>true, "test_type"=>"Item Condition", "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, "Ref_9"=>{"test"=>"", "options"=>[{"route"=>"End", "value"=>"Missing", "output"=>"Missing", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"End", "value"=>"Mismatch", "output"=>"Mismatch", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"End", "value"=>"Fake", "output"=>"Fake", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"End", "value"=>"Complete damage", "output"=>"Defective", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}], "picture"=>true, "test_type"=>"Item Condition", "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, "Ref_10"=>{"test"=>"", "options"=>[{"route"=>"End", "value"=>"Mismatch", "output"=>"Mismatch", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"End", "value"=>"Fake", "output"=>"Fake", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"End", "value"=>"Complete damage", "output"=>"Defective", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}], "picture"=>true, "test_type"=>"Item Condition", "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, "Ref_11"=>{"test"=>"", "options"=>[{"route"=>"End", "value"=>"Fake", "output"=>"Fake", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, {"route"=>"End", "value"=>"Complete damage", "output"=>"Defective", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}], "picture"=>true, "test_type"=>"Item Condition", "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, "Ref_12"=>{"test"=>"", "options"=>[{"route"=>"End", "value"=>"Complete damage", "output"=>"Defective", "picture"=>true, "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}], "picture"=>true, "test_type"=>"Item Condition", "annotation"=>true, "annotations"=>["Like New", "Minor Scratches", "Minor Dent", "Minor Damage", "Major Scratches", "Major Dent", "Major Damage"], "picture_labels"=>["Left", "Right", "Top", "Bottom"], "annotation_label"=>"Physical"}, "Ref_13"=>{"test"=>"Powering On", "options"=>[{"route"=>"Ref_17", "value"=>"Yes", "output"=>"Functional", "picture"=>false, "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}, {"route"=>"Ref_15", "value"=>"No", "output"=>"", "picture"=>false, "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}], "picture"=>false, "test_type"=>"Functional", "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}, "Ref_15"=>{"test"=>"Power Cable Present and Intact", "options"=>[{"route"=>"Ref_17", "value"=>"Yes", "output"=>"Functional", "picture"=>false, "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}, {"route"=>"Ref_17", "value"=>"No", "output"=>"Functional with Minor Defect", "picture"=>false, "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}], "picture"=>false, "test_type"=>"Functional", "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}, "Ref_17"=>{"test"=>"Keys are functioning", "options"=>[{"route"=>"Ref_19", "value"=>"Yes", "output"=>"Functional", "picture"=>false, "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}, {"route"=>"Ref_19", "value"=>"No", "output"=>"Functional with Minor Defect", "picture"=>false, "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}], "picture"=>false, "test_type"=>"Functional", "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}, "Ref_19"=>{"test"=>"Excessive Noice or Vibration", "options"=>[{"route"=>"Ref_21", "value"=>"Yes", "output"=>"Defective", "picture"=>false, "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}, {"route"=>"Ref_21", "value"=>"No", "output"=>"Functional", "picture"=>false, "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}], "picture"=>false, "test_type"=>"Functional", "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}, "Ref_21"=>{"test"=>"", "options"=>[{"route"=>"End", "value"=>"All", "output"=>"All", "picture"=>false, "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}, {"route"=>"End", "value"=>"Some", "output"=>"Some", "picture"=>false, "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}, {"route"=>"End", "value"=>"None", "output"=>"None", "picture"=>false, "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}], "picture"=>false, "test_type"=>"Accessories", "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}, "Ref_22"=>{"test"=>"", "options"=>[{"route"=>"End", "value"=>"Some", "output"=>"Some", "picture"=>false, "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}, {"route"=>"End", "value"=>"None", "output"=>"None", "picture"=>false, "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}], "picture"=>false, "test_type"=>"Accessories", "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}, "Ref_23"=>{"test"=>"", "options"=>[{"route"=>"End", "value"=>"None", "output"=>"None", "picture"=>false, "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}], "picture"=>false, "test_type"=>"Accessories", "annotation"=>false, "annotations"=>[], "picture_labels"=>[], "annotation_label"=>""}}, "Physical_precedence"=>{"Like New"=>0, "Major Dent"=>5, "Minor Dent"=>2, "Major Damage"=>6, "Minor Damage"=>3, "Major Scratches"=>4, "Minor Scratches"=>1}, "functional_precedence"=>{"Defective"=>2, "Functional"=>0, "Functional with Minor Defect"=>1}}
		t.update(rules: r)
		g = GradingRule.find 3
		r = {"grade_rules"=>[{"grade"=>"New", "test_groups"=>[{"test"=>"Packaging", "answers"=>["Seal Pack"]}]}, {"grade"=>"Open Box", "test_groups"=>[{"test"=>"Item Condition", "answers"=>["Unused Returned"]}, {"test"=>"Functional", "answers"=>["Functional"]}, {"test"=>"Physical", "answers"=>["Like New", "NA"]}, {"test"=>"Packaging", "answers"=>["Open Box", "Minor Damage"]}, {"test"=>"Accessories", "answers"=>["All"]}]}, {"grade"=>"Very Good", "test_groups"=>[{"test"=>"Item Condition", "answers"=>["Unused Returned"]}, {"test"=>"Functional", "answers"=>["Functional"]}, {"test"=>"Physical", "answers"=>["Like New", "Minor Dent", "Minor Scratches", "Minor Damage", "Minor Damage", "Minor Missing Items", "NA"]}, {"test"=>"Packaging", "answers"=>["Open Box", "Minor Damage", "Major Damage", "Not Available", "Brown Box Available"]}, {"test"=>"Accessories", "answers"=>["All", "Some", "None", "Fake", "NA"]}]}, {"grade"=>"Good", "test_groups"=>[{"test"=>"Item Condition", "answers"=>["Unused Returned"]}, {"test"=>"Functional", "answers"=>["Functional", "Functional with Minor Defect"]}, {"test"=>"Physical", "answers"=>["Like New", "Minor Dent", "Minor Scratches", "Major Dent", "Major Scratches", "Minor Damage", "Minor Missing Items", "Major Missing Items", "", "Visible Usage Marks Inside", "NA"]}, {"test"=>"Packaging", "answers"=>["Open Box", "Minor Damage", "Major Damage", "Not Available", "Brown Box Available"]}, {"test"=>"Accessories", "answers"=>["All", "Some", "None", "Fake", "NA"]}]}, {"grade"=>"Defective", "test_groups"=>[{"test"=>"Item Condition", "answers"=>["Unused Returned", "Used", "Mismatch", "Fake", "Complete damage"]}, {"test"=>"Functional", "answers"=>["Defective", "NA", "Functional", "Functional with Minor Defect"]}, {"test"=>"Physical", "answers"=>["Like New", "Minor Dent", "Minor Scratches", "Major Dent", "Major Scratches", "Minor Damage", "Major Damage", "Visible Usage Marks Inside", "Major Items Missing", "NA"]}, {"test"=>"Packaging", "answers"=>["Open Box", "Minor Damage", "Major Damage", "Not Available", "Brown Box Available", "NA"]}, {"test"=>"Accessories", "answers"=>["All", "Some", "None", "Fake", "NA"]}]}, {"grade"=>"As-Is", "test_groups"=>[{"test"=>"Item Condition", "answers"=>["Unused Returned", "Used"]}, {"test"=>"Functional", "answers"=>["NA", "Power On"]}, {"test"=>"Physical", "answers"=>["Like New", "Minor Dent", "Minor Scratches", "Major Dent", "Major Scratches", "Minor Damage", "Major Damage", "Visible Usage Marks Inside", "Major Items Missing", "NA"]}, {"test"=>"Packaging", "answers"=>["Open Box", "Minor Damage", "Major Damage", "Not Available", "Brown Box Available"]}, {"test"=>"Accessories", "answers"=>["All", "Some", "None", "Fake"]}]}, {"grade"=>"Not Tested", "test_groups"=>[{"test"=>"Functional", "answers"=>["NA"]}, {"test"=>"Physical", "answers"=>["NA"]}, {"test"=>"Packaging", "answers"=>["NA"]}, {"test"=>"Accessories", "answers"=>["NA"]}]}, {"grade"=>"End"}], "grade_precedence"=>{"New"=>"0", "Good"=>"3", "As-Is"=>"5", "Open Box"=>"1", "Defective"=>"4", "Very Good"=>"2", "Not Tested"=>"6"}}
		g.update(rules: r)
		precedence = {"RTV"=>"1", "E-Waste"=>"2", "Restock"=>"0", "Liquidation"=>"3"}
		rule_definition = [{"name"=>"Restock", "definition"=>"@Packaging"}, {"name"=>"RTV", "definition"=>"@Physical && @Functional && @Packaging"}, {"name"=>"E-Waste", "definition"=>"@Physical && @Packaging"}, {"name"=>"Liquidation", "definition"=>"@Physical && @Functional && @Packaging"}]
		condition = [{"name"=>"Restock", "condition"=>{"Physical"=>[], "Functional"=>[], "Packaging"=>["Seal Pack"]}}, {"name"=>"RTV", "condition"=>{"Physical"=>["Like New", "Minor Dent", "Minor Scratches", "Minor Damage", "NA"], "Functional"=>["Functional with Minor Defect", "Defective", "NA"], "Packaging"=>["Open Box", "Minor Damage", "Brown Box Available", "Not Available"]}}, {"name"=>"E-Waste", "condition"=>{"Physical"=>["Like New ", "Major Dent", "Major Scratches", "Major Damage", "NA"], "Functional"=>["Functional with Minor Defect", "Defective", "NA"], "Packaging"=>["Open Box", "Minor Damage", "Brown Box Available", "Not Available"]}}, {"name"=>"Liquidation", "condition"=>{"Physical"=>["Like New", "Minor Dent", "Minor Scratches", "Minor Damage", "NA"], "Functional"=>["Functional"], "Packaging"=>["Open Box", "Minor Damage", "Brown Box Available", "Not Available"]}}]
		r = Rule.find 2
		r.update(precedence: precedence, rule_definition: rule_definition, condition: condition)
	end

end
